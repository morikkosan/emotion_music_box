<!-- app/views/comments/_comment.html.erb -->
<turbo-frame id="comment_<%= comment.id %>">
  <div class="d-flex justify-content-between align-items-start my-2 p-2 border rounded">

    <!-- 左側：ユーザー名＋本文 -->
    <div>
      <strong><%= comment.user.name %></strong>
      <p class="mb-1"><%= comment.body %></p>
    </div>

    <!-- 右側：リアクションボタンだけ Stimulus で制御 -->
    <div class="d-flex flex-column align-items-end ms-3">
      <% unless comment.user == current_user %>
        <% [:sorena, :yonda].each do |kind| %>
          <% count   = comment.comment_reactions.count { |r| r.kind == kind.to_s } %>
          <% reacted = comment.comment_reactions.any? { |r| r.user_id == current_user.id && r.kind == kind.to_s } %>

          <button 
            type="button"
            data-controller="reaction"
            data-action="click->reaction#toggle"
            data-reaction-comment-id-value="<%= comment.id %>"
            data-reaction-kind-value="<%= kind %>"
            data-reaction-target="button"
            class="btn btn-sm mb-1 <%= reacted ? 'btn-primary' : 'btn-outline-secondary' %>">
            <%= kind == :sorena ? "👍 それな" : "🎉 よんだ" %>
            <span data-reaction-target="count"><%= count %></span>
          </button>
        <% end %>
      <% end %>
    </div>

  </div>
</turbo-frame>
