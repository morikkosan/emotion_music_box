<!-- app/views/comments/_comment.html.erb -->
<turbo-frame id="comment_<%= comment.id %>">
  <div class="d-flex justify-content-between align-items-start my-2 p-2 border rounded">
    <!-- å·¦å´ï¼šã‚¢ãƒã‚¿ãƒ¼ï¼‹ãƒ¦ãƒ¼ã‚¶ãƒ¼åï¼‹æœ¬æ–‡ -->
    <div class="d-flex align-items-start gap-2">
      <% if comment.user.avatar_url.present? %>
        <%= image_tag comment.user.avatar_url, alt: "ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒ", width: 60, height: 60, class: "rounded-circle flex-shrink-0" %>
      <% else %>
        <%= image_tag "default_avatar.png", alt: "ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒ", width: 60, height: 60, class: "rounded-circle flex-shrink-0" %>
      <% end %>

      <div>
        <strong><%= comment.user.name %></strong>
        <p class="mb-1"><%= comment.body %></p>
      </div>
    </div>

    <!-- å³å´ï¼šãƒœã‚¿ãƒ³ç¾¤ -->
    <div class="d-flex flex-column align-items-end ms-3">
      <% if comment.user == current_user %>
        <!-- è‡ªåˆ†ã®ã‚³ãƒ¡ãƒ³ãƒˆãªã‚‰ç·¨é›†ï¼å‰Šé™¤ -->
        <%= link_to "ç·¨é›†", edit_comment_path(comment),
                    class: "btn btn-link btn-sm text-primary mb-1" %>
        <%= button_to comment_path(comment), method: :delete,
              class: "btn btn-link btn-sm text-danger",
              form: { data: { turbo_stream: true, turbo_confirm: "å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ" } },
              data: { disable_with: "å‰Šé™¤ä¸­â€¦" } do %>
          å‰Šé™¤
        <% end %>
      <% else %>
        <!-- ä»–äººã®ã‚³ãƒ¡ãƒ³ãƒˆãªã‚‰ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ -->
       <% [:sorena, :yonda].each do |kind| %>
  <% count   = comment.comment_reactions.count { |r| r.kind == kind.to_s } %>
  <% reacted = comment.comment_reactions.any? { |r| r.user_id == current_user.id && r.kind == kind.to_s } %>

  <% 
    # è‰²ã ã‘åˆ†ã‘ã‚‹ï¼ˆæµ®ãã®ã‚¯ãƒ©ã‚¹ã¯å¾Œã§è¿½åŠ ï¼‰
    btn_color_class = case kind
                      when :sorena then reacted ? "btn-success" : "btn-outline-success"
                      when :yonda  then reacted ? "btn-info"    : "btn-outline-info"
                      end

    # æµ®ãã‚¨ãƒ•ã‚§ã‚¯ãƒˆã¯active-reactionã‚¯ãƒ©ã‚¹ã§
    active_class = reacted ? "active-reaction" : ""
  %>

  <button
    type="button"
    data-controller="reaction"
    data-action="click->reaction#toggle"
    data-reaction-comment-id-value="<%= comment.id %>"
    data-reaction-kind-value="<%= kind %>"
    data-reaction-target="button"
    class="btn btn-sm mb-1 transition-colors <%= btn_color_class %> <%= active_class %>">
    <%= kind == :sorena ? "ðŸ‘ ãã‚Œãª" : "ðŸŽ‰ ã‚ˆã‚“ã " %>
    <span data-reaction-target="count"><%= count %></span>
  </button>
<% end %>
      <% end %>
    </div>
  </div>
</turbo-frame>
