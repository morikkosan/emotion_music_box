<%# app/views/shared/_notification_toggle.html.erb %>
<% fid = local_assigns[:frame_id] || (defined?(mobile_device?) && mobile_device? ? "notification-toggle-mobile" : "notification-toggle-desktop") %>

<turbo-frame id="<%= fid %>">
  <div
    class="dropdown-item d-flex align-items-center gap-2 position-relative"
    data-controller="notif-badge"
    data-notif-badge-endpoint-value="<%= unread_count_notifications_path(format: :json) %>"
    data-notif-badge-poll-interval-value="30000"
    data-notif-badge-modal-url-value="<%= modal_notifications_path(format: :turbo_stream) %>"
    data-action="click->notif-badge#openModal"><!-- ← ラッパーにclick -->

    <%= image_tag "bell_on.webp",
          class: "dropdown-icon", alt: "",
          loading: "lazy", decoding: "async",
          width: 24, height: 24 %>

    <span class="notif-count-badge" data-notif-badge-target="badge" aria-live="polite" hidden>0</span>

    <%= link_to "通知（一覧）",
          modal_notifications_path(format: :turbo_stream),
          class: "text-decoration-none text-body" %>
  </div>
</turbo-frame>
