<% content_for :head do %>
  <%= stylesheet_link_tag "application", media: "all", "data-turbo-track": "reload" %>
<% end %>

<div class="container d-flex justify-content-center align-items-center min-vh-100">
  <div class="card p-4" style="width: 100%; max-width: 500px;">
    <h2 class="text-center mb-4">新規登録</h2>

    <%= form_for(resource, as: resource_name,
                 url: registration_path(resource_name),
                 html: { multipart: true }) do |f| %>

      <%= render "devise/shared/error_messages", resource: resource %>

      <!-- 名前 -->
      <div class="form-group">
        <%= f.label :name %> <span class="text-danger">*</span><br />
        <%= f.text_field :name,
                         class: "form-control",
                         placeholder: "Enter your name" %>
      </div>

      <!-- 性別 -->
      <div class="form-group">
        <%= f.label :gender %><br />
        <%= f.select :gender,
                     [["未選択", ""], ["男性", "male"], ["女性", "female"], ["その他", "other"]],
                     {}, class: "form-control" %>
      </div>

      <!-- 年齢 -->
      <div class="form-group">
        <%= f.label :age %><br />
        <%= f.number_field :age,
                           class: "form-control",
                           min: 0, max: 120,
                           placeholder: "年齢を入力（任意）" %>
      </div>

      <!-- メール
      <div class="form-group">
        <%= f.label :email %><span class="text-danger">*</span><br />
        <%= f.email_field :email,
                          autofocus: true,
                          autocomplete: "email",
                          class: "form-control" %>
      </div> -->

      <!-- パスワード -->
      <!-- <div class="form-group">
        <%= f.label :password %><span class="text-danger">*</span><br />
        <%= f.password_field :password,
                             autocomplete: "new-password",
                             class: "form-control" %>
      </div> -->

      <!-- パスワード確認 -->
      <!-- <div class="form-group">
        <%= f.label :password_confirmation %><br />
        <%= f.password_field :password_confirmation,
                             autocomplete: "new-password",
                             class: "form-control" %>
      </div> -->

      <!-- アバターアップロード -->
      <div class="form-group text-center mt-3">
        <% if resource.respond_to?(:avatar) && resource.avatar.attached? %>
          <%= image_tag resource.avatar.variant(resize_to_fill: [80, 80]).processed,
                        id:    "avatarPreviewInline",
                        class: "rounded-circle mb-2",
                        alt:   "現在のアイコン" %><br>
        <% else %>
          <%= image_tag "default_stick_figure.png",
                        id:    "avatarPreviewInline",
                        size:  "80x80",
                        class: "rounded-circle mb-2",
                        alt:   "デフォルトアイコン" %><br>
        <% end %>

        <%= f.file_field :avatar,
                         id:    "avatarInput",
                         class: "form-control-file" %>

        <%= f.hidden_field :cropped_avatar_data,
                           id: "croppedAvatarData" %>
      </div>

      <!-- 登録ボタン -->
      <div class="form-group text-center">
        <%= f.submit "アカウント作成", class: "btn btn-primary" %>
      </div>
    <% end %>

    <!-- <p class="text-center mt-3">
      <%= link_to 'ログインはこちら', new_session_path(resource_name),
                  class: 'btn btn-secondary btn-sm' %>
    </p>
  </div>
</div> -->

<!-- Cropper 用モーダル -->
<div class="modal fade" id="avatarCropModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header"><h5 class="modal-title">アイコンをトリミング</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
      <div class="modal-body d-flex justify-content-center">
        <div id="cropContainer"
             style="width:300px;height:300px;overflow:hidden;position:relative;background:#eee;">
          <img id="cropImage"
               src=""
               style="position:absolute; top:0; left:0; cursor:grab; max-width:none; max-height:none; user-select:none;" />
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" id="cropConfirmBtn" class="btn btn-primary">確定</button>
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">キャンセル</button>
      </div>
    </div>
  </div>
</div>
