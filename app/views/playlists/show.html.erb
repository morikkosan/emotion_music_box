<% if @playlist.playlist_items.empty? %>
  <p>まだ曲が追加されていません。</p>
<% else %>

  <!-- ★ 1曲目から再生ボタン（縦中央・左端に固定） -->
  <div class="playlist-playfirst-fixed">
    <button
      type="button"
      class="btn neon_show neon_show-back"
      data-action="click->global-player#playFirstTrack"
      style="display: flex; align-items: center; gap: .7em;">
      <i class="fa fa-play"></i>
      1曲目から再生
    </button>
  </div>

  <ul class="list-unstyled mt-3" style="width:100%; max-width:700px; margin:auto;" id="<%= dom_id(@playlist, :contents) %>">
    <% @playlist.playlist_items.includes(:emotion_log).each do |item| %>
      <% log = item.emotion_log %>
      <li class="mb-4" style="max-width:600px; width:100%; margin: 0 auto;">
        <div class="pmx_playlist_row">
          <div class="pmx_cover_wrapper">
            <%= image_tag(
                  log.music_art_url || "default_cover.png",
                  alt: log.track_name,
                  class: "rounded shadow pmx_cover_img",
                  data: {
                    "global-player-target" => "trackImage",
                    "track-id"             => log.id,
                    "play-url"             => log.music_url
                  }
                ) %>
            <i class="fa fa-play play-overlay-icon"
               data-action="click->global-player#loadAndPlay"
               data-global-player-target="playIcon"
               data-track-id="<%= log.id %>"
               data-play-url="<%= log.music_url %>"></i>
          </div>
          <div class="pmx_song_info">
            <div class="fw-bold neon-btn-title" style="font-size: 1.1rem;">
              <%= log.track_name %>
            </div>
            <div class="text-muted small mt-1">
              投稿: <%= log.user&.name || "匿名" %>
            </div>
          </div>
          <div class="pmx_remove_button">
            <%= button_to "削除",
                  playlist_playlist_item_path(@playlist, item),
                  method: :delete,
                  data: {
                    turbo_confirm: "本当にこの曲をプレイリストから削除しますか？",
                    turbo_frame: dom_id(@playlist, :contents)
                  },
                  class: "btn btn-danger btn-sm" %>
          </div>
        </div>
      </li>
    <% end %>
    <li style="max-width:600px; width:100%; margin: 0 auto; display:flex; justify-content:center; gap:1.3rem;">
      <%= link_to "← プレイリスト一覧に戻る",
                  bookmarks_emotion_logs_path(view: 'mobile'),
                  class: "neon_show neon_show-back btn" %>
      <%= button_to raw('<i class="fa fa-trash me-2"></i>プレイリストを削除する'),
            playlist_path(@playlist),
            method: :delete,
            data: { turbo: false },
            onclick: "return confirm('本当にこのプレイリストを削除しますか？');",
            class: "neon_show neon_show-delete btn" %>
    </li>
  </ul>

<% end %>

<style>
/* --- 各曲リスト 横並びで中央寄せ --- */
.pmx_playlist_row {
  display: flex;
  align-items: center;
  justify-content: flex-start;
  gap: 1.1rem;
  width: 100%;
  max-width: 600px;
  min-height: 90px;
  margin: 0 auto;
}
.pmx_song_info {
  flex: 1 1 auto;
  min-width: 0;
  display: flex;
  flex-direction: column;
  gap: 0.3rem;
}
.pmx_remove_button {
  flex: 0 0 auto;
  display: flex;
  align-items: center;
  margin-left: 0.8rem;
}
.pmx_cover_wrapper {
  position: relative;
  width: 88px;
  height: 88px;
  flex: 0 0 88px;
}
.pmx_cover_img {
  width: 88px;
  height: 88px;
  object-fit: cover;
}
.play-overlay-icon {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 2rem;
  color: #fff !important;
  opacity: 0.98;
  cursor: pointer;
  pointer-events: auto;
}

/* --- プレイリスト下のボタン --- */
.neon_show-back, .neon_show-delete {
  font-weight: bold;
  border-radius: 2rem;
  border: none;
  color: #fff !important;
  display: inline-flex;
  align-items: center;
  gap: .5em;
  letter-spacing: 0.01em;
  transition: transform 0.13s, box-shadow 0.13s, filter 0.16s;
  text-shadow: none;
}
.neon_show-back {
  background: linear-gradient(90deg, #2196f3 0%, #0d47a1 100%);
  /* ↑濃い青系に変更：白成分無し */
  font-size: 1.10rem;
  padding: 0.68rem 2.0rem;
  box-shadow: 0 2px 8px #1687ce48, 0 1px 3px #2221;
  font-weight: 900;
  color: #fff !important;
}
.neon_show-back:hover {
  filter: brightness(1.08) drop-shadow(0 0 7px #2196f3cc);
  transform: translateY(-1px) scale(1.04);
}
.neon_show-delete {
  background: linear-gradient(90deg, #b81942 10%, #d93b7b 80%, #c045e8 100%);
  font-size: 0.96rem;
  padding: 0.45rem 1.0rem 0.45rem 0.82rem;
  box-shadow: 0 1.2px 4px #b8194233;
  font-weight: 700;
  opacity: 0.89;
  margin-left: 0.6rem;
}
.neon_show-delete .fa-trash {
  font-size: 1.08em;
  margin-right: .19em;
  color: #fff;
  filter: none;
}

/* --- 1曲目から再生ボタン：縦中央・左端に固定 --- */
.playlist-playfirst-fixed {
  position: fixed;
  top: 50%;
  left: 350px;
  transform: translateY(-50%);
  z-index: 1002;
}
@media (max-width: 700px) {
  .playlist-playfirst-fixed {
    left: 5px;
    top: unset;
    bottom: 17%;
    transform: none;
  }
}
.playlist-playfirst-fixed button {
  font-size: 1.05rem;
  padding: 0.68rem 1.6rem 0.68rem 1.15rem;
  border-radius: 2.2rem;
  opacity: 0.88;
  background: linear-gradient(90deg, #2ecbff 50%, #1775d1 100%);
  box-shadow: 0 2px 10px #1bb4ff44;
  transition: filter 0.18s, opacity 0.18s, box-shadow 0.18s;
}
.playlist-playfirst-fixed button:hover {
  filter: brightness(1.12) drop-shadow(0 0 8px #6fdcff99);
  opacity: 1;
  box-shadow: 0 4px 18px #19d6ff99;
}
</style>
