<% if @playlist.playlist_items.empty? %>
  <p class="text-center">まだ曲が追加されていません。</p>
<% else %>
  <!-- 親要素にコントローラをアタッチ -->
  <div class="playlist-container" data-controller="global-player">
    <!-- プレイリスト本体 -->
    <ul id="<%= dom_id(@playlist, :contents) %>" class="list-unstyled mt-3 playlist-contents">
      <% @playlist.playlist_items.includes(:emotion_log).each do |item| %>
        <% log = item.emotion_log %>
        <!-- 行ごとに id を付与（差し替え/削除に便利） -->
        <li class="mb-4" id="<%= dom_id(log) %>">
          <div class="pmx_playlist_row d-flex align-items-center">
            <!-- 左：アートワーク＋再生アイコン -->
            <div class="pmx_cover_wrapper me-3">
              <%= image_tag(
                    log.music_art_url || "placeholder.webp",
                    alt: log.track_name,
                    class: "rounded shadow pmx_cover_img",
                    data: {
                      "global-player-target" => "trackImage",
                      "track-id"             => log.id,
                      "play-url"             => log.music_url
                    }
                  ) %>
              <i class="fa fa-play play-overlay-icon"
                 data-action="click->global-player#onPlayIconClick"
                 data-global-player-target="playIcon"
                 data-track-id="<%= log.id %>"
                 data-play-url="<%= log.music_url %>"></i>
            </div>

            <!-- 中央：曲名＋投稿者 -->
            <div class="pmx_song_info flex-grow-1">
              <div class="fw-bold neon-btn-title"><%= log.track_name %></div>
              <div class="text-muted small mt-1">
                投稿: <%= log.user&.name || "匿名" %>
              </div>
            </div>

            <!-- 右：削除ボタン（※ data-turbo-frame は付けない） -->
            <div class="pmx_remove_button">
              <%= button_to raw('<i class="fa fa-trash"></i>'),
                    playlist_playlist_item_path(@playlist, item),
                    method: :delete,
                    data: { turbo_confirm: "本当にこの曲を削除しますか？" },
                    class: "btn btn-danger btn-sm" %>
            </div>
          </div>
        </li>
      <% end %>
    </ul>
  </div>
<% end %>
