<!-- app/views/playlists/_playlist_contents.html.erb -->
<div id="<%= dom_id(playlist, :contents) %>">
  <ul class="list-unstyled mt-3 playlist-contents">
    <% items = playlist_items || [] %>

    <% items.each do |item| %>
      <% log = item.emotion_log %>
      <li class="mb-4" id="<%= dom_id(log || item, :row) %>">
        <div class="pmx_playlist_row d-flex align-items-center">
          <!-- 左：アートワーク＋再生アイコン -->
          <div class="pmx_cover_wrapper me-3">
            <%= image_tag(
                  (log&.music_art_url).presence || "placeholder.webp",
                  alt: (log&.track_name).presence || "（タイトル未設定）",
                  class: "rounded shadow pmx_cover_img",
                  data: {
                    "global-player-target" => "trackImage",
                    "track-id"             => log&.id,
                    "play-url"             => log&.music_url
                  }
                ) %>
            <i class="fa fa-play play-overlay-icon"
               data-action="click->global-player#onPlayIconClick"
               data-global-player-target="playIcon"
               data-track-id="<%= log&.id %>"
               data-play-url="<%= log&.music_url %>"></i>
          </div>

          <!-- 中央：曲名＋投稿者 -->
          <div class="pmx_song_info flex-grow-1">
            <div class="fw-bold neon-btn-title">
              <%= (log&.track_name).presence || (log&.music_url).to_s.presence || "（タイトル未設定）" %>
            </div>
            <div class="text-muted small mt-1">
              投稿: <%= log&.user&.name || "匿名" %>
            </div>
          </div>

          <!-- 右：削除ボタン -->
          <div class="pmx_remove_button">
            <%= button_to raw('<i class="fa fa-trash"></i>'),
                  playlist_playlist_item_path(playlist, item),
                  method: :delete,
                  data: { turbo_confirm: "本当にこの曲を削除しますか？" },
                  class: "btn btn-danger btn-sm" %>
          </div>
        </div>
      </li>
    <% end %>
  </ul>
</div>
