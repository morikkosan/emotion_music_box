# EMOTION MUSIC BOX
音楽と感情のアプリ

### ER図
![ER図](https://i.gyazo.com/61026d2bc54eaf1947f83289763d18b1.png)

---

## 目次
- [サービス概要](#サービス概要)
- [このサービスへの思い・作りたい理由](#このサービスへの思い作りたい理由)
- [ユーザー層について](#ユーザー層について)
- [サービスの差別化ポイント・推しポイント](#サービスの差別化ポイント推しポイント)
- [機能候補](#機能候補)
- [主な機能](#主な機能)
- [使い方（3ステップ）](#使い方3ステップ)
- [リリース時点の挙動メモ](#リリース時点の挙動メモ)
- [テスト構成（Jest 概要）](#テスト構成jest-概要)
- [使用技術（Tech Stack）](#使用技術tech-stack)

---

## サービス概要

**現代人が日々感じるストレスを、音楽と気分の記録を通じて軽減する。**  
ユーザーはその時の気分に合った音楽を探して再生するだけでなく、**自身の感情と音楽の組み合わせを投稿し、他のユーザーと共有できるコミュニティ型サービス**です。

## このサービスへの思い・作りたい理由

私は**音楽専門学校**を経て、以前バンドでライブをしたり曲を作ったり、**音楽に携わること**をしていました。  
**音楽なしでは生きられない**人間でした。  
小学生の時から**iPod**などを使用し、気分によってどんなジャンルの音楽を聴いていたかで**ストレスを和らげていました**。  
音楽によるストレス発散は、僕だけじゃなく**誰しもがそうです**。  
だからこそ、このアプリを作りたいと思いました。

## ユーザー層について

**ストレスを抱える現代人、音楽で気分を切り替えたい人。**  
年齢や性別を問わず、**気軽に使えるサービス**です。

## サービスの差別化ポイント・推しポイント

- **感情と音楽の融合**  
  単なる音楽ストリーミングやSNSではなく、「**今の気分**」と「**音楽**」を結びつけることで、自分の状態を客観的に把握しやすくなります。  
  **HPバー**や**ゲージ**で**ストレス状態を可視化**し、ユーザー自身の変化に気づかせると同時に、**コミュニティの共感**も呼びます。

## 機能候補
（※MVP構想時の見出しを残しています。実装済みの内容は下記「主な機能」を参照）

---

## 主な機能

### 1) アカウント / 認証
- SoundCloud OAuth によるログイン（OmniAuth）
- セッション管理（Redis セッションストア）

### 2) 投稿（感情ログ）
- 感情（例：イライラ / 楽しい など）＋曲情報＋ひとことメモを1つのログとして保存
- タグ付け、ブックマーク数・コメント数を表示
- 投稿詳細ページ（モバイル用とPC用の最適化ビュー）

### 3) 検索・再生
- SoundCloud の曲情報を利用した楽曲再生（埋め込み/リンク再生）
- ログ一覧から曲へ即アクセス

### 4) ブックマーク & プレイリスト
- 気になった投稿をブックマーク → 後からプレイリストに追加
- プレイリスト画面
  - 1曲目から再生
  - 曲の削除
  - 「曲を追加」モーダル（ブックマーク済みの中から、**プレイリスト未収録のみ**を表示）
- **Turbo Stream** による即時反映  
  追加／削除で **プレイリスト本体とモーダル候補が自動更新**

### 5) コメント & リアクション
- 投稿にコメント
- いいね等のリアクション

### 6) シェア
- X（Twitter）共有ボタン（投稿からワンタップでシェア）

### 7) モバイル最適化
- モバイル専用のフッターメニュー（再生／追加／戻る／削除）
- セーフエリア（iPhone）対応、軽量なUI部品
- 主要操作を画面下部に集約して片手操作しやすく

### 8) 通知
- Web Push（VAPID）でコメント/いいね等の通知

### 9) 運用/品質
- 例外監視：Sentry
- 構造化ログ：Lograge
- 画像配信：Cloudinary（Active Storage）
- 開発環境：Docker Compose（PostgreSQL/Redis/HTTPS）
- フロント：Hotwire（Turbo/Stimulus）

---

## 使い方（3ステップ）
1. **ログイン**：SoundCloud アカウントでサインイン  
2. **投稿**：その時の感情と曲、ひとことを記録  
3. **楽しむ**：気になる投稿はブックマーク → プレイリストに追加して再生

---

## リリース時点の挙動メモ
- プレイリストへの**追加・削除は即時反映**（Turbo Stream）。  
  モーダルを閉じずに連続追加が可能。閉じても再読み込みは不要です。
- モバイルでもフッターメニューが常時固定で操作しやすい設計。

---

## テスト構成（Jest 概要）
- `spec/javascripts/globals/application.entry.test.js`  
  …エントリの基本（UJSログ、push二重防止、ローダー、モーダル保険など）
- `spec/javascripts/globals/application.entry.extra.test.js`  
  …アバター（Crop確定／Cloudinary 分岐、recommend など周辺UI）
- `spec/javascripts/globals/application.entry.toppers.test.js`  
  …取りこぼし潰し（turbo:before-cache、2つの MutationObserver 等）
- `spec/javascripts/globals/application.entry.tinygap.test.js`  
  …微細な枝や条件の最終カバー

---

## 使用技術（Tech Stack）

### ランタイム / 基盤
- **Ruby 3.2.3**
- **Rails 7.2.2.1**（Hotwire: Turbo / Stimulus）
- Docker / Docker Compose（v2）

### インフラ・ミドルウェア
- **PostgreSQL**
- **Redis**（セッションストア）
- **HTTPS**（Puma + PEM）

### フロントエンド（Rails 内）
- Hotwire（Turbo / Stimulus）
- Bootstrap 5.3
- jsbundling-rails / cssbundling-rails
- Sprockets（一部アセット）

### 認証・認可
- Devise
- OmniAuth（SoundCloud OAuth2 / Generic OAuth2）

### ストレージ / 画像
- Active Storage + Cloudinary
- image_processing

### 画面/UX・ページング・集計
- Kaminari（bootstrap5-kaminari-views）
- Groupdate

### 通信 / ユーティリティ
- HTTParty / Faraday

### 監視・ログ
- Sentry（sentry-rails / sentry-ruby）
- Lograge
